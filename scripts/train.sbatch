#!/bin/bash
#SBATCH --job-name=training_network
#SBATCH --partition=cuda
#SBATCH --gres=gpu:2
#SBATCH --ntasks=1
#SBATCH --output=pdc%j.log
#SBATCH --time=24:00:00

module load nvidia/cudasdk/10.1
module load singularity/3.2.1
chmod +x scripta/train.bash

singularity exec -B /usr/local/cuda-10.1 -B /usr/bin/nvidia-cuda-mps-control -B /usr/bin/nvidia-cuda-mps-server -B /usr/share/logwatch/scripts/services/barracuda -B /usr/share/logwatch/default.conf/services/barracuda.conf -B /usr/share/man/man1/nvidia-cuda-mps-control.1.gz -B /usr/share/vim/vim74/syntax/cuda.vim -B /usr/share/vim/vim74/indent/cuda.vim -B /usr/lib64/libicudata.so.50.1.2 -B /usr/lib64/libcuda.so.1 -B /usr/lib64/libcuda.so.440.95.01 -B /usr/lib64/pkgconfig/cudart-10.1.pc -B /usr/lib64/pkgconfig/cuda-10.1.pc -B /usr/lib64/libicudata.so.50 -B /usr/lib64/libcuda.so -B /usr/include/linux/cuda.h -B /usr/src/kernels/3.10.0-957.el7.x86_64/include/linux/cuda.h -B /usr/src/kernels/3.10.0-957.el7.x86_64/include/uapi/linux/cuda.h -B /usr/src/kernels/3.10.0-957.el7.x86_64.debug/include/linux/cuda.h -B /usr/src/kernels/3.10.0-957.el7.x86_64.debug/include/uapi/linux/cuda.h -B /usr/src/nvidia-440.95.01/ -B /usr/bin/nvidia-cuda-mps-control -B /usr/bin/nvidia-cuda-mps-server -B /usr/bin/nvidia-debugdump -B /usr/bin/nvidia-bug-report.sh -B /usr/bin/nvidia-persistenced -B /usr/bin/nvidia-xconfig -B /usr/bin/nvidia-smi -B /usr/bin/nvidia-modprobe -B /usr/lib64/libnvidia-ifr.so.440.95.01 -B /usr/lib64/libnvidia-allocator.so.440.95.01 -B /usr/lib64/libnvidia-compiler.so.440.95.01 -B /usr/lib64/libGLESv2_nvidia.so.2 -B /usr/lib64/libGLESv2_nvidia.so.440.95.01 -B /usr/lib64/libnvidia-glsi.so.440.95.01 -B /usr/lib64/libnvidia-ml.so -B /usr/lib64/libnvidia-encode.so.1 -B /usr/lib64/libnvidia-fbc.so.440.95.01 -B /usr/lib64/libnvidia-opencl.so.440.95.01 -B /usr/lib64/libnvidia-opticalflow.so.440.95.01 -B /usr/lib64/libnvidia-glcore.so.440.95.01 -B /usr/lib64/libGLESv1_CM_nvidia.so.1 -B /usr/lib64/nagios/plugins/check_nvidiasmi.sh -B /usr/lib64/libnvidia-cfg.so.440.95.01 -B /usr/lib64/pkgconfig/nvidia-ml-10.1.pc -B /usr/lib64/libnvidia-tls.so.440.95.01 -B /usr/lib64/libnvidia-cbl.so.440.95.01 -B /usr/lib64/libnvidia-cfg.so.1 -B /usr/lib64/libnvidia-fbc.so -B /usr/lib64/libnvidia-ptxjitcompiler.so -B /usr/lib64/libnvidia-cfg.so -B /usr/lib64/libnvidia-fatbinaryloader.so.440.95.01 -B /usr/lib64/libGLESv1_CM_nvidia.so.440.95.01 -B /usr/lib64/libnvidia-ptxjitcompiler.so.440.95.01 -B /usr/lib64/libnvidia-glvkspirv.so.440.95.01 -B /usr/lib64/libnvidia-opticalflow.so.1 -B /usr/lib64/libEGL_nvidia.so.440.95.01 -B /usr/lib64/libnvidia-eglcore.so.440.95.01 -B /usr/lib64/libnvidia-allocator.so.1 -B /usr/lib64/libnvidia-ml.so.1 -B /usr/lib64/vdpau/libvdpau_nvidia.so.440.95.01 -B /usr/lib64/vdpau/libvdpau_nvidia.so.1 -B /usr/lib64/libnvidia-ifr.so -B /usr/lib64/libnvidia-fbc.so.1 -B /usr/lib64/libnvidia-opencl.so.1 -B /usr/lib64/libnvidia-encode.so.440.95.01 -B /usr/lib64/libnvidia-encode.so -B /usr/lib64/nvidia -B /usr/lib64/xorg/modules/drivers/nvidia_drv.so -B /usr/lib64/xorg/modules/extensions/libglxserver_nvidia.so -B /usr/lib64/libnvidia-ml.so.440.95.01 -B /usr/lib64/libGLX_nvidia.so.440.95.01 -B /usr/lib64/libnvidia-rtcore.so.440.95.01 -B /usr/lib64/libnvidia-ptxjitcompiler.so.1 -B /usr/lib64/libEGL_nvidia.so.0 -B /usr/lib64/libGLX_nvidia.so.0 -B /usr/lib64/libnvidia-ifr.so.1 -B /usr/lib64/pkgconfig/cublas-10.pc -B /usr/lib64/libcublas.so -B /usr/lib64/libcublas.so.10 -B /usr/lib64/libcublas.so.10.2.2.89 -B /usr/lib64/libcublasLt.so.10.2.2.89 -B /usr/lib64/libcublasLt.so -B /usr/lib64/libcublas_static.a -B /usr/lib64/stubs/libcublas.so -B /usr/lib64/stubs/libcublasLt.so -B /usr/lib64/libcublasLt_static.a -B /usr/lib64/libcublasLt.so.10 -B /usr/include/cublasXt.h -B /usr/include/cublas_api.h -B /usr/include/cublasLt.h -B /usr/include/cublas_v2.h -B /usr/include/cublas.h -B ${TMPDIR} container/tensorflowUbuntu.img ./scripts/train.bash

